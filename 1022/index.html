<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>유튜브 인기 노래 (KR)</title>
</head>
<body>
  <h2>유튜브 인기 노래 (한국)</h2>

  <button id="reload">불러오기</button>
  <span id="status"></span>

  <hr />

  <div id="list"></div>

  <script>
    const listEl = document.getElementById("list");
    const statusEl = document.getElementById("status");

    function fmt(n) {
      if (!Number.isFinite(n)) return "-";
      return n.toLocaleString("ko-KR");
    }

    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, (m) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[m]));
    }

    async function load() {
      statusEl.textContent = "불러오는중임";
      listEl.innerHTML = "";

      try {
        const r = await fetch(`/api/trending?maxResults=12`);
        const data = await r.json();
        if (!r.ok) throw new Error(data?.detail || "API error");

        const items = data.items || [];
        statusEl.textContent = `총 ${items.length}개`;

        const ul = document.createElement("ul");

        for (const v of items) {
          const li = document.createElement("li");

          li.innerHTML = `
            <a href="${v.url}" target="_blank" rel="noreferrer">
              ${escapeHtml(v.title || "")}
            </a>
            <div>
              채널: ${escapeHtml(v.channelTitle || "")}
              | 조회수: ${fmt(v.viewCount)}
              | 좋아요: ${fmt(v.likeCount)}
            </div>
          `;

          ul.appendChild(li);
        }

        listEl.appendChild(ul);
      } catch (e) {
        statusEl.textContent = "실패: " + String(e.message || e);
      }
    }

    document.getElementById("reload").addEventListener("click", load);
    load();
  </script>
</body>
</html>
